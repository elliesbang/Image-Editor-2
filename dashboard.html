<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>관리자 대시보드 · Elliesbang Image Editor</title>
  <link rel="stylesheet" href="./static/style.css" />
  <style>
    body { padding: 2rem; background: var(--color-background); }
    .dashboard-card { background: var(--color-surface); border-radius: 24px; padding: 2.5rem; box-shadow: var(--shadow-soft); max-width: 720px; margin: 0 auto; display: flex; flex-direction: column; gap: 1.25rem; }
    .dashboard-card h1 { margin-bottom: 0.5rem; }
    .dashboard-card__status { display: flex; gap: 1rem; flex-wrap: wrap; }
    .status-pill { background: rgba(255, 211, 49, 0.25); padding: 0.6rem 1rem; border-radius: 999px; font-weight: 600; }
    .dashboard-empty { text-align: center; padding: 4rem 1rem; border: 2px dashed rgba(64, 64, 64, 0.15); border-radius: 18px; background: rgba(255, 211, 49, 0.08); }
    .warning { color: #d04444; font-weight: 700; }
  </style>
</head>
<body>
  <div class="dashboard-card" data-role="dashboard-card">
    <h1>관리자 대시보드</h1>
    <p>Cloudflare Pages Functions 로그와 환경 변수를 관리하려면 Cloudflare Dashboard에서 프로젝트를 확인하세요.</p>
    <div class="dashboard-empty" data-role="dashboard-content">세션을 확인하는 중입니다...</div>
  </div>
  <script type="module">
    async function validateSession() {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      const card = document.querySelector('[data-role="dashboard-card"]');
      const content = document.querySelector('[data-role="dashboard-content"]');
      if (!token) {
        content.innerHTML = '<p class="warning">접근 권한이 없습니다. 로그인 페이지로 이동해주세요.</p>';
        setTimeout(() => { window.location.replace('./index.html'); }, 2500);
        return;
      }
      try {
        const response = await fetch('/api/admin/validate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token }),
        });
        if (!response.ok) {
          throw new Error('unauthorized');
        }
        const data = await response.json();
        content.innerHTML = `
          <div class="dashboard-card__status">
            <span class="status-pill">관리자: ${data.email}</span>
            <span class="status-pill">만료 시각: ${new Date(data.expiresAt * 1000).toLocaleString()}</span>
          </div>
          <p>현재 버전은 Cloudflare Pages Functions를 통해 인증, SVG 변환, SEO 분석을 처리하도록 구성되어 있습니다. 세부 로그는 Cloudflare Analytics에서 확인할 수 있습니다.</p>
        `;
      } catch (error) {
        content.innerHTML = '<p class="warning">접근 권한이 없습니다. 로그인 페이지로 이동해주세요.</p>';
        setTimeout(() => { window.location.replace('./index.html'); }, 2500);
      }
    }

    validateSession();
  </script>
</body>
</html>
